"use strict";angular.module("google.places",[]).factory("googlePlacesApi",["$window",function(e){if(!e.google)throw"Global `google` var missing. Did you forget to include the places API script?";return e.google}]).directive("gPlacesAutocomplete",["$parse","$compile","$timeout","$document","googlePlacesApi",function(e,t,n,i,c){return{restrict:"A",require:"^ngModel",scope:{model:"=ngModel",options:"=?",forceSelection:"=?",customPlaces:"=?"},controller:["$scope",function(e){}],link:function(e,o,s,r){var l,a,p,u={tab:9,enter:13,esc:27,up:38,down:40},d=[u.tab,u.enter,u.esc,u.up,u.down],f=new c.maps.places.AutocompleteService,g=new c.maps.places.PlacesService(o[0]);function h(t){0!==e.predictions.length&&-1!==function(e,t){var n,i;if(null===e)return-1;for(i=e.length,n=0;n<i;n++)if(e[n]===t)return n;return-1}(d,t.which)&&(t.preventDefault(),t.which===u.down?(e.active=(e.active+1)%e.predictions.length,e.$digest()):t.which===u.up?(e.active=(e.active?e.active:e.predictions.length)-1,e.$digest()):13===t.which||9===t.which?(e.forceSelection&&(e.active=-1===e.active?0:e.active),e.$apply(function(){e.selected=e.active,-1===e.selected&&w()})):27===t.which&&e.$apply(function(){t.stopPropagation(),w()}))}function m(t){0!==e.predictions.length&&(e.forceSelection&&(e.selected=-1===e.selected?0:e.selected),e.$digest(),e.$apply(function(){-1===e.selected&&w()}))}function v(){var t;(t=e.predictions[e.selected])&&(t.is_custom?e.$apply(function(){e.model=t.place,e.$emit("g-places-autocomplete:select",t.place),n(function(){r.$viewChangeListeners.forEach(function(e){e()})})}):g.getDetails({placeId:t.place_id},function(i,o){o==c.maps.places.PlacesServiceStatus.OK&&e.$apply(function(){i.predictionText=t.description,e.model=i,e.$emit("g-places-autocomplete:select",i),n(function(){r.$viewChangeListeners.forEach(function(e){e()})})})}),w())}function $(t){var n;return t&&P(t)?(e.query=t,n=angular.extend({input:t},e.options),f.getPlacePredictions(n,function(t,n){e.$apply(function(){var i;w(),e.customPlaces&&(i=function(t){var n,i,c,o=[];for(c=0;c<e.customPlaces.length;c++)n=e.customPlaces[c],(i=_(t,n)).matched_substrings.length>0&&o.push({is_custom:!0,custom_prediction_label:n.custom_prediction_label||"(Custom Non-Google Result)",description:n.formatted_address,place:n,matched_substrings:i.matched_substrings,terms:i.terms});return o}(e.query),e.predictions.push.apply(e.predictions,i)),n==c.maps.places.PlacesServiceStatus.OK&&e.predictions.push.apply(e.predictions,t),e.predictions.length>5&&(e.predictions.length=5)})}),e.forceSelection?r.$modelValue:t):t}function b(e){var t,n="";return P(e)?n=e:(t=e,"[object Object]"==Object.prototype.toString.call(t)&&(n=e.formatted_address)),n}function y(){return o.val(r.$viewValue)}function w(){e.active=-1,e.selected=-1,e.predictions=[]}function _(e,t){var n,i,c,o=e+"",s=[],r=[];for(i=t.formatted_address.split(","),c=0;c<i.length;c++)n=i[c].trim(),o.length>0&&(n.length>=o.length?(x(n,o)&&r.push({length:o.length,offset:c}),o=""):x(o,n)?(r.push({length:n.length,offset:c}),o=o.replace(n,"").trim()):o=""),s.push({value:n,offset:t.formatted_address.indexOf(n)});return{matched_substrings:r,terms:s}}function P(e){return"[object String]"==Object.prototype.toString.call(e)}function x(e,t){return 0===A(e).lastIndexOf(A(t),0)}function A(e){return null===e?"":e.toLowerCase()}e.query="",e.predictions=[],e.input=o,e.options=e.options||{},a=angular.element("<div g-places-autocomplete-drawer></div>"),p=angular.element(i[0].body),a.attr({input:"input",query:"query",predictions:"predictions",active:"active",selected:"selected"}),l=t(a)(e),p.append(l),e.$on("$destroy",function(){l.remove()}),o.bind("keydown",h),o.bind("blur",m),o.bind("submit",m),e.$watch("selected",v),r.$parsers.push($),r.$formatters.push(b),r.$render=y}}}]).directive("gPlacesAutocompleteDrawer",["$window","$document",function(e,t){return{restrict:"A",scope:{input:"=",query:"=",predictions:"=",active:"=",selected:"="},template:['<div class="pac-container" ng-if="isOpen()" ng-style="{top: position.top+\'px\', left: position.left+\'px\', width: position.width+\'px\'}" style="display: block;" role="listbox" aria-hidden="{{!isOpen()}}">','  <div class="pac-item" g-places-autocomplete-prediction index="$index" prediction="prediction" query="query"','       ng-repeat="prediction in predictions track by $index" ng-class="{\'pac-item-selected\': isActive($index) }"','       ng-mouseenter="selectActive($index)" ng-click="selectPrediction($index)" role="option" id="{{prediction.id}}">',"  </div>","</div>"].join(""),link:function(n,i){function c(n){var i=n[0].getBoundingClientRect(),c=t[0].documentElement,o=t[0].body,s=e.pageYOffset||c.scrollTop||o.scrollTop,r=e.pageXOffset||c.scrollLeft||o.scrollLeft;return{width:i.width,height:i.height,top:i.top+i.height+s,left:i.left+r}}i.bind("mousedown",function(e){e.preventDefault()}),e.onresize=function(){n.$apply(function(){n.position=c(n.input)})},n.isOpen=function(){return n.predictions.length>0},n.isActive=function(e){return n.active===e},n.selectActive=function(e){n.active=e},n.selectPrediction=function(e){n.selected=e},n.$watch("predictions",function(){n.position=c(n.input)},!0)}}}]).directive("gPlacesAutocompletePrediction",[function(){return{restrict:"A",scope:{index:"=",prediction:"=",query:"="},template:['<span class="pac-icon pac-icon-marker"></span>','<span class="pac-item-query" ng-bind-html="prediction | highlightMatched"></span>','<span ng-repeat="term in prediction.terms | unmatchedTermsOnly:prediction">{{term.value | trailingComma:!$last}}&nbsp;</span>','<span class="custom-prediction-label" ng-if="prediction.is_custom">&nbsp;{{prediction.custom_prediction_label}}</span>'].join("")}}]).filter("highlightMatched",["$sce",function(e){return function(t){var n,i="",c="";return t.matched_substrings.length>0&&t.terms.length>0&&(n=t.matched_substrings[0],i=t.terms[0].value.substr(n.offset,n.length),c=t.terms[0].value.substr(n.offset+n.length)),e.trustAsHtml('<span class="pac-matched">'+i+"</span>"+c)}}]).filter("unmatchedTermsOnly",[function(){return function(e,t){var n,i,c=[];for(n=0;n<e.length;n++)i=e[n],t.matched_substrings.length>0&&i.offset>t.matched_substrings[0].length&&c.push(i);return c}}]).filter("trailingComma",[function(){return function(e,t){return t?e+",":e}}]);